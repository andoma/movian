Major rewrite of UI rendering code.

This is a preparation for Showtime 5.0 which will sport a new UI
